<?xml version='1.0' encoding='UTF-8' ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/templates/layout.xhtml"
 xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
	
      
<ui:define name="cuerpo"> 
  	  	
  	<h:form id="datatableOT">
  	
		<p:dataTable   var="ot" value="#{mb_OT.lista}" id="datatable2OT"  emptyMessage="Sin Registros"
		 paginator="true" rows ="50" resizableColumns="true" liveResize="true" draggableColumns="true" 
		 scrollable="false"      scrollWidth="100%"   
		 editable="true"   
		 tableStyle="height:auto;" 
		 style="text-align:left;max-height:500px;overflow-y:scroll; 
   font-size: 90% !important;color: red;font-weight: bold;"
		selection="#{mb_OT.otSelected}" selectionMode="single" rowKey="#{ot.id}"
		paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
		 >
		 
		 		  <f:facet name="{Exporters}">
	    <h:commandLink>
	      <p:graphicImage name="/images/excel.png" width="24"/>
	      <p:dataExporter type="xls" target="datatable2OT" fileName="ot"   />
	    </h:commandLink>
	
	    <h:commandLink>
	      <p:graphicImage name="/images/pdf.png" width="24"/>
	      <p:dataExporter type="pdf" target="datatable2OT" fileName="ot"  />
	    </h:commandLink> 
		</f:facet>
		 
		 
		 	<f:facet name="header">
		        Ordenes de Trabajo
		 
		        <p:commandButton id="toggler" type="button" value="Elegir Columnas" style="float:right" icon="ui-icon-calculator" />
		        <p:columnToggler datasource="datatable2OT" trigger="toggler" />
		    </f:facet>
		 
		 <p:ajax event="rowEdit" listener="#{mb_OT.onRowEdit}" update="datatableOT" />
		 
		  <p:ajax event="rowToggle"   update="datatable3" />
		

	   <p:column style="width:16px" stylr="color:red" exportable="false">		
            <p:rowToggler />
        </p:column>	
		 
		 
		 
		 
			<p:column headerText="Id" sortBy="#{ot.id}"  filterMatchMode="startsWith" filterBy="#{ot.id}">
		        <h:outputText  value="#{ot.id}"/>
		    </p:column>
		 

		<p:column style="min-width:200px" headerText="Cliente:" sortBy="#{ot.clienteNombre}"  filterMatchMode="contains" filterBy="#{ot.clienteNombre}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{ot.clienteNombre}" /></f:facet>
	               <f:facet name="input"><p:inputText id="cliente" value="#{ot.clienteNombre}" style="width:100%"/></f:facet>
           		</p:cellEditor>
	</p:column>	  



    <h:outputLink id="content" value="#">
        <h:outputText value="PrimeFaces" />
    </h:outputLink>
    <p:tooltip id="toolTipContent" for="content" position="bottom">
        <p:graphicImage name="/demo/images/logo-trans.png" />
    </p:tooltip>




		    		 
			<p:column style="min-width:200px" headerText="Trabajo:" sortBy="#{ot.trabajo}"  filterMatchMode="contains" filterBy="#{ot.trabajo}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{ot.trabajo}" /></f:facet>
	               <f:facet name="input"><p:inputText id="trabajo" value="#{ot.trabajo}" style="width:100%"/></f:facet>
           		</p:cellEditor>
		    </p:column>


			<p:column headerText="Proc" sortBy="#{ot.proceso}"  filterMatchMode="contains" filterBy="#{ot.proceso}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{ot.proceso}" /></f:facet>
	               <f:facet name="input"><p:inputText id="proceso" value="#{ot.proceso}" style="width:100%"/></f:facet>
           		</p:cellEditor>
		    </p:column>	

		 
	
			 <p:column headerText="Pres" sortBy="#{ot.presupuesto}"  filterMatchMode="contains" filterBy="#{ot.presupuesto}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{ot.presupuesto}" /></f:facet>
	               <f:facet name="input"><p:inputText id="presupuesto" value="#{ot.presupuesto}" style="width:100%"/></f:facet>
           		</p:cellEditor>
		    </p:column>
		    		 
		  
		    		 
			<p:column headerText="Fact" sortBy="#{ot.factura}"  filterMatchMode="contains" filterBy="#{ot.factura}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{ot.factura}" /></f:facet>
	               <f:facet name="input"><p:inputText id="factura" value="#{ot.factura}" style="width:100%"/></f:facet>
           		</p:cellEditor>
		    </p:column>
		    
	   
		    		  
	   	    		 

		    


	  
	  
	  
				<p:column headerText="F.Inicio"  style="min-width:100px;"  sortBy="#{ot.fechaInicio}"  filterMatchMode="contains" filterBy="#{ot.fechaInicio}">		                
				   <p:cellEditor>
				         <f:facet name="output">
				         	<p:calendar mindate="#{ot.fechaInicio}" maxdate="#{ot.fechaInicio}" id="inicio" value="#{ot.fechaInicio}"
				          pattern="dd-MM-yyyy" mask="true" />
						</f:facet>
				         <f:facet name="input"> <p:calendar id="nacimientoin" value="#{ot.fechaInicio}" pattern="dd-MM-yyyy" mask="true" />
		 				</f:facet>
					</p:cellEditor>
				</p:column>
	  
	  				<p:column headerText="F.Fin"  style="min-width:100px;"  sortBy="#{ot.fechaTerminada}"  filterMatchMode="contains" filterBy="#{ot.fechaTerminada}">		                
				   <p:cellEditor>
				         <f:facet name="output">
				         	<p:calendar mindate="#{ot.fechaTerminada}" maxdate="#{ot.fechaTerminada}" id="terminadaout" value="#{ot.fechaTerminada}"
				          pattern="dd-MM-yyyy" mask="true" />
						</f:facet>
				         <f:facet name="input"> <p:calendar id="terminadain" value="#{ot.fechaTerminada}" pattern="dd-MM-yyyy" mask="true" />
		 				</f:facet>
					</p:cellEditor>
				</p:column>
	  
	  
	  				<p:column headerText="F.Facturada"  style="min-width:100px;"  sortBy="#{ot.fechaFacturada}"  filterMatchMode="contains" filterBy="#{ot.fechaFacturada}">		                
				   <p:cellEditor>
				         <f:facet name="output">
				         	<p:calendar mindate="#{ot.fechaFacturada}" maxdate="#{ot.fechaFacturada}" id="facturada" value="#{ot.fechaFacturada}"
				          pattern="dd-MM-yyyy" mask="true" />
						</f:facet>
				         <f:facet name="input"> <p:calendar id="facturadain" value="#{ot.fechaFacturada}" pattern="dd-MM-yyyy" mask="true" />
		 				</f:facet>
					</p:cellEditor>
				</p:column> 
	  
	  
	  
	  
	  
		  
		  <p:rowExpansion id="datatable3">	  		
	  
	   
<p:commandButton value="Ver Adicionales"  update=":datatableADI:datatable2ADI" 
onclick="PF('verad').show();#{mb_OT.recargarListaAdicionales(ot.id)}"
action="#{mb_OT.recargarListaAdicionales(ot.id)}"/> 

	  
<p:commandButton value="Ver Compras Externas" update=":datatableCE:datatable2CE" 
onclick="PF('verce').show()" 
action="#{mb_OT.recargarListaComprasExternas(ot.id)}"
/>  


 
<p:commandButton value="Ver Mano de Obra" update=":datatableMO:datatable2MO" 
onclick="PF('vermo').show();" 
action="#{mb_OT.recargarListaManoObra(ot.id)}"/> 

 	  
<p:commandButton value="Ver Movimientos" update=":datatableMOV:datatable2MOV"
onclick="PF('vermov').show()"   
action="#{mb_OT.recargarListaMovimientos(ot.id)}"/> 

<br/>


<p:commandButton value="Agregar Adicional" 
onclick="PF('addad').show();#{mb_OT.setNumeroID(ot.id)};#{mb_OT.setNumeroID(ot.id)};"
action="#{mb_OT.setNumeroID(ot.id)}"/>  
	


<p:commandButton value="Agregar Compras Externas"
onclick="PF('addce').show();" 
actionListener="#{mb_OT.setearIDOT(ot.id)}"/>  
    
			
			 
<p:commandButton value="Agregar Mano Obra"  update="formAddMO"
onclick="PF('addmo').show();#{mb_OT.setNumeroID(ot.id)}" 
	action="#{mb_ManoObra.setOrdenTrabajo(ot.id)}"/>  
			


<p:commandButton value="Agregar Movimiento" update="formAddMov"
onclick="PF('addmov').show()" 
actionListener="#{mb_Movimiento.ajustesAddMovimentoOT(ot.cliente,ot.id)}">  
</p:commandButton>


<br/> 

<p:column headerText="Pdf" style="width:40px" stylr="color:red">  
 
<p:commandButton  icon="ui-icon-print" id="imprimir"  onclick="window.open('#{mb_OT.urlImprimirMov(ot.id)}','_blank');" 
action="#{mb_OT.urlImprimirOT(ot.id)}"  update="message"   />
 
</p:column>


<p:column headerText="Pdf" style="width:40px" stylr="color:red">  
 
<p:commandButton  icon="ui-icon-print" id="imprimir2" onclick="window.open('#{mb_OT.urlImprimirOT(ot.id)}','_blank');" 
action="#{mb_OT.urlImprimirMov(ot.id)}"  update="message"   />
 
</p:column>

   
		  </p:rowExpansion>


 





 

		 
		 		   <p:column toggleable="false" headerText="Edit"  style = "width:20px" rendered="#{mb_Usuario.acceso('EDITAR',mb_Usuario.ot)}" exportable="false">						
					<p:rowEditor >
					</p:rowEditor>									
		    </p:column>
		     
		    <p:column toggleable="false" headerText="Bor"  style = "width:20px"  rendered="#{mb_Usuario.acceso('BORRAR',mb_Usuario.ot)}" exportable="false">		
			<p:commandLink actionListener="#{mb_OT.delete(ot)}" 
   	
   	update="datatableOT message" >
        <p:confirm header="Confirmacion" message="Borrar OT nro:#{ot.id}?" icon="ui-icon-alert" />
  <span class="ui-icon ui-icon-trash"></span>
   	</p:commandLink>    
    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="Borrar" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" oncomplete="processWidget.clearFilters();" />
        <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
    </p:confirmDialog>
			</p:column>


 
		    	   
		      
		</p:dataTable>
	
	
		<p:contextMenu for="datatable2OT">
  	<p:menuitem value="Adicionales" update="datatableADI" icon="ui-icon-search" oncomplete="PF('verad').show()"/>
  	<p:menuitem value="Compras externas" update="datatableCE" icon="ui-icon-search" oncomplete="PF('verce').show()"/>
   	<p:menuitem value="Mano de Obra" update="datatableADI" icon="ui-icon-search" oncomplete="PF('vermo').show()"/>
   	<p:menuitem value="Movimientos" update="datatableADI" icon="ui-icon-search" oncomplete="PF('vermov').show()"/>
  	<p:menuitem value="Imprimir Ot"  icon="ui-icon-search" oncomplete="window.open('#{mb_OT.urlImprimirOT(ot.id)}','_blank');"/>
   	<p:menuitem value="Imprimir Movimientos" update="datatableADI" icon="ui-icon-search" oncomplete="window.open('#{mb_OT.urlImprimirMov(ot.id)}','_blank');"/>
		</p:contextMenu>
	
	
	

  </h:form>

 
<p:dialog header="Adicionales" widgetVar="verad"  modal="true" width="90%" height="400" id="verad"  dynamic="true">
<ui:include src="/templates/templateadicional.xhtml" id="listaAdicionales">	 
</ui:include>
</p:dialog>	   
 
 <p:dialog header="Compras Externas" widgetVar="verce"  modal="true" width="90%" height="400"  dynamic="true">
<ui:include src="/templates/templatecompraexterna.xhtml" id="listaCE">	
</ui:include>
</p:dialog>

<p:dialog header="Mano de Obra" widgetVar="vermo"  modal="true" width="90%" height="400"  dynamic="true">
<ui:include src="/templates/templatemanoobra.xhtml" id="listaMovimientos">					
</ui:include>			
</p:dialog>	

<p:dialog header="Movimientos"  id="vermov" widgetVar="vermov"  modal="true" width="90%" height="400"  dynamic="true">
<ui:include src="/templates/templatemovimiento.xhtml" id="listaMovimientos">	
<ui:param name="paramLista"   value = "#{mb_OT.listaMovimientos}"/>					
</ui:include>			
</p:dialog>	



<p:dialog header="Agregar Adicional" id="addad" widgetVar="addad"  modal="true" width="580px" height="230">
<ui:include src="/templates/templateaddadicional.xhtml" id="addadicional">			
</ui:include>			
</p:dialog>	

<p:dialog header="Agregar Compra Externa" widgetVar="addce"  modal="true" width="450" height="390">
<ui:include src="/templates/templateaddcompraexterna.xhtml" id="listaComprasExternasOUT">			
</ui:include>			
</p:dialog>	    

<p:dialog header="Agregar Mano Obra" widgetVar="addmo"  modal="true" width="460" height="450"  dynamic="true">
<ui:include src="/templates/templateaddmanoobra.xhtml" id="addmanoobra">			
<ui:param name="verIDOT"   value = "true"/>
</ui:include>			
</p:dialog>		
	
<p:dialog header="Agregar Movimiento" widgetVar="addmov"    modal="true" width="90%" height="550" >
<ui:include src="/templates/templateaddmovimiento.xhtml" id="addmovimiento">	
  <ui:param name="paramListaCodMov"   value = "#{mb_Movimiento.listaCodMovimientosEnOt}"/>			
</ui:include>			
</p:dialog>
	


	
	
	
	
	
	
	
	  

</ui:define>
</ui:composition>



 		     			 
<!-- 				<p:column headerText="Arre" sortBy="#{ot.arrendamiento}"  filterMatchMode="contains" filterBy="#{ot.arrendamiento}">		                 -->
<!-- 		        <p:cellEditor> -->
<!-- 	               <f:facet name="output"><h:outputText value="#{ot.arrendamiento}" /></f:facet> -->
<!-- 	               <f:facet name="input"><p:inputText id="arrendamiento" value="#{ot.arrendamiento}" style="width:100%"/></f:facet> -->
<!--            		</p:cellEditor> -->
<!-- 		    </p:column>   -->
		    		 
			
			 
			 
<!-- 			<p:column headerText="Mant" sortBy="#{ot.mantenimiento}"  filterMatchMode="contains" filterBy="#{ot.mantenimiento}">		                 -->
<!-- 		        <p:cellEditor> -->
<!-- 	               <f:facet name="output"><h:outputText value="#{ot.mantenimiento}" /></f:facet> -->
<!-- 	               <f:facet name="input"><p:inputText id="mantenimiento" value="#{ot.mantenimiento}" style="width:100%"/></f:facet> -->
<!--            		</p:cellEditor> -->
<!-- 		    </p:column> -->

<!-- 			<p:column headerText="Tipo" sortBy="#{ot.tipoID}"  filterMatchMode="contains" filterBy="#{ot.tipoID}">		                 -->
<!-- 		        <p:cellEditor> -->
<!-- 	               <f:facet name="output"><h:outputText value="#{ot.tipoID}" /></f:facet> -->
<!-- 	               <f:facet name="input"><p:inputText id="tipoID" value="#{ot.tipoID}" style="width:100%"/></f:facet> -->
<!--            		</p:cellEditor> -->
<!-- 		    </p:column> -->

<!-- <p:commandButton value="Agregar Movimiento" update="formAddMov" -->
<!-- onclick="PF('addmov').show()"  -->
<!-- actionListener="#{mb_Movimiento.ajustesAddMovimentoOT(ot.cliente,ot.id)}">   -->
<!-- <f:actionListener binding="#{mb_Movimiento.setReferencia(ot.id)}" /> -->
<!-- </p:commandButton> -->







<!-- <p:dialog header="Ot en PDF" widgetVar="verpdf" id="verpdf"  modal="true" width="90%" height="550"      -->
<!--     closable="true" closeOnEscape="true" draggable="true" -->
<!--     onHide="jQuery('#someId').hide();" onShow="jQuery('#someId').show();"> -->
<!--     <h:form prependId="false"> -->
<!--     <h:outputFormat escape="false"> -->
<!--     <iframe src="#{mb_OT.urlImprimirOT(ot.id)}" -->
<!--     name="someName" id="someId" scrolling="auto" width="100%"    height="550"  /> -->
<!--     </h:outputFormat> -->
<!--     </h:form>  -->
<!-- </p:dialog>	 -->
	
	
<!-- <p:dialog header="Movimiento en PDF" widgetVar="verpdfmov" id="verpdfmov"  modal="true" width="90%" height="550"      -->
<!--     closable="true" closeOnEscape="true" draggable="true" -->
<!--     onHide="jQuery('#someId').hide();" onShow="jQuery('#someId').show();"> -->
<!--     <h:form prependId="false"> -->
<!--     <h:outputFormat escape="false"> -->
<!--     <iframe src="#{mb_OT.urlImprimirMov(ot.id)}" -->
<!--     name="someName" id="someId" scrolling="auto" width="100%"    height="550"  /> -->
<!--     </h:outputFormat> -->
<!--     </h:form>  -->
<!-- </p:dialog>	 -->
