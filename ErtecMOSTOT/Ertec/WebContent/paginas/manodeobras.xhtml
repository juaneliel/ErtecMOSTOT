<?xml version='1.0' encoding='UTF-8' ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/templates/layout.xhtml"
 xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
      

<ui:define name="cuerpo">   	 
 
 	
<h:form id="formmanodeobra">

<p:panelGrid        columns="3">  
<p:panelGrid      columns="2">
<p:outputLabel for="maskIni" value="Fecha inicial:" />
<p:calendar id="maskIni" value="#{mb_ManoObra.fechaIni}" pattern="dd-MM-yyyy" mask="true"  effect="fold" />
</p:panelGrid>
<p:panelGrid    columns="2"> 
<p:outputLabel for="maskFin" value="  Fecha final:" />
<p:calendar id="maskFin" value="#{mb_ManoObra.fechaFin}" pattern="dd-MM-yyyy" mask="true" effect="fold" />
</p:panelGrid>
<p:commandButton value="Buscar"  icon="ui-icon-trash" id="Buscar" action="#{mb_ManoObra.filtrarPorFechas}"   
update="datatablemanodeobra :message"/> 
</p:panelGrid>
 
 
<p:dataTable var="mo" value="#{mb_ManoObra.lista}" id="datatablemanodeobra"  widgetVar="datatablemanodeobra"
		selection="#{mb_ManoObra.moSelected}" selectionMode="single" rowKey="#{mo.manoObraID}"	
		 paginator="true" rows ="50" resizableColumns="true" liveResize="true" draggableColumns="true" 
		 scrollable="true"    scrollWidth="100%"   currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords}" 
		 editable="true"   emptyMessage="Sin Registros"
		 style="text-align:left;	font-size: 90% !important;color: red;font-weight: bold;" 
		 	 paginatorTemplate=" {agregar} {titulo} {CurrentPageReport} {RowsPerPageDropdown}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters} {vercol}"
    rowsPerPageTemplate="10,50,100"		
	>
  
			<f:facet name="{Exporters}">
            <h:commandLink>
                <p:graphicImage name="/images/excel.png" width="24"/>
                <p:dataExporter type="xls" target="datatable2MO" fileName="manoobra" />
            </h:commandLink>
 
            <h:commandLink>
                <p:graphicImage name="/images/pdf.png" width="24"/>
                <p:dataExporter type="pdf" target="datatable2MO" fileName="manoobra"/>
            </h:commandLink> 
			</f:facet>
			
			
			<f:facet name="{titulo}">
		        Mano de obra		 		        
		 </f:facet>
		    
		 <f:facet name="{agregar}">    
		  <p:commandButton value="Agregar"  oncomplete="PF('addmanodeobra').show()" style="float:left"
		  	rendered="#{mb_Usuario.acceso('AGREGAR','manodeobra')}" />      
      </f:facet>
		 
		 <f:facet name="{vercol}">   
		    	<p:commandButton id="toggler" type="button" value="Elegir Columnas" style="float:right" icon="ui-icon-calculator" />
					<p:columnToggler datasource="datatablemanodeobra" trigger="toggler" />      	 
		    </f:facet> 
		    
		     
   
    
  <p:ajax event="rowEdit" listener="#{mb_ManoObra.onRowEdit}" update="message" />
	<p:ajax event="rowEditInit" listener="#{mb_ManoObra.clickEdit(mo)}" update="message" />
	
		 <p:column toggleable="false" headerText=""  style = "width:0px" rendered="#{mb_Usuario.acceso('EDITAR','manodeobra')}"  exportable="false">					
					<p:rowEditor >
					</p:rowEditor>									
		    </p:column>

		<p:column headerText="ID" sortBy="#{mo.manoObraID}"  filterMatchMode="contains" filterBy="#{mo.manoObraID}">		                
		   <h:outputText value="#{mo.manoObraID}" />
		</p:column>
		 
		 
		 
		<p:column headerText="Clliente:" style="min-width:140px;" sortBy="#{mo.clienteNombre}"  filterMatchMode="contains" filterBy="#{mo.clienteNombre}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.clienteNombre}" /></f:facet>
		         <f:facet name="input">
		         <p:autoComplete  id="cliente" value="#{mo.cliente}"
 							completeMethod="#{mb_Usuario.completarCliente}" 
							var="theme" itemLabel="#{theme.nombre}" itemValue="#{theme}"
 							converter="ConverterCliente" forceSelection="true" 
 							style="float:left !important;margin:0px 0px 3px 0px;"/> 		         
			     </f:facet>
			</p:cellEditor>
		</p:column> 
    
 




		<p:column headerText="Funcionario Nombre:" style="min-width:140px;" sortBy="#{mo.funcionario.nombre}"  filterMatchMode="contains" filterBy="#{mo.funcionario.nombre}">		                
		   <p:cellEditor>
		   	<f:facet name="output"><h:outputText value="#{mo.funcionario.nombre}" /></f:facet>
		    <f:facet name="input">
					<p:autoComplete id="funcionario" value="#{mo.funcionario}"
					 	completeMethod="#{mb_Usuario.completarFuncionario}"
						var="theme" itemLabel="#{theme.nombre}" itemValue="#{theme}"
					 	converter="ConverterFuncionario" forceSelection="true" 
					  style="float:left !important;margin:0px 0px 3px 0px;"
					  queryDelay="1000" 
					  /> 
				</f:facet>
			</p:cellEditor>
		</p:column>
		
				
		
		
		<p:column headerText="N Contrato:" sortBy="#{mo.NContrato}"  filterMatchMode="contains" filterBy="#{mo.NContrato}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.NContrato}" /></f:facet>
		         <f:facet name="input"><p:inputText id="NContrato" value="#{mo.NContrato}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>

    
    		<p:column headerText="Codigo:" sortBy="#{mo.codigo}"  filterMatchMode="contains" filterBy="#{mo.codigo}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.codigo}" /></f:facet>
		         <f:facet name="input">
					<p:selectOneMenu value="#{mo.codigo}" style="width:100%">
                       <f:selectItems value="#{mb_ManoObra.listaCodMO}" var="cmo" 
                       itemLabel="#{cmo.descripcion}" itemValue="#{cmo.codigo}" />
                   </p:selectOneMenu>
		         </f:facet>
			</p:cellEditor>
		</p:column>
    
 
	       		   
		<p:column headerText="Fecha:" style="min-width:100px;"  sortBy="#{mo.fecha}"  filterMatchMode="contains" filterBy="#{mo.fecha}">		                
		   <p:cellEditor>
		         <f:facet name="output">
		         	<p:calendar mindate="#{mo.fecha}" maxdate="#{mo.fecha}" id="maskout" value="#{mo.fecha}"
		          pattern="dd-MM-yyyy" mask="true" />
				</f:facet>
		         <f:facet name="input"> <p:calendar id="maskin" value="#{mo.fecha}" pattern="dd-MM-yyyy" mask="true" />
 				</f:facet>
			</p:cellEditor>
		</p:column>
	       		   
 
		<p:column headerText="MYR" sortBy="#{mo.myr}"  filterMatchMode="contains" filterBy="#{mo.myr}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.myr}" /></f:facet>
		         <f:facet name="input"><p:inputText id="MYR" value="#{mo.myr}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>

	 
       			<p:column headerText="O.T.:" sortBy="#{mo.ordenTrabajo}"  filterMatchMode="contains" filterBy="#{mo.ordenTrabajo}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.ordenTrabajo}" /></f:facet>
		         <f:facet name="input"><p:inputText id="ot" value="#{mo.ordenTrabajo}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
       	


    
     
     		<p:column headerText="T. Contrato" sortBy="#{mo.TContrato}"  filterMatchMode="contains" filterBy="#{mo.TContrato}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.TContrato}" /></f:facet>
		         <f:facet name="input"><p:inputText id="tcon" value="#{mo.TContrato}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
    
    		<p:column headerText="Tipo:" sortBy="#{mo.tipo}"  filterMatchMode="contains" filterBy="#{mo.tipo}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.tipo}" /></f:facet>
		         <f:facet name="input"><p:inputText id="tipo" value="#{mo.tipo}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
    
     
    
    		<p:column headerText="Tipo Hora" sortBy="#{mo.tipoHora}"  filterMatchMode="contains" filterBy="#{mo.tipoHora}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.tipoHora}" /></f:facet>
		         <f:facet name="input"><p:inputText id="thora" value="#{mo.tipoHora}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
    
     
    
    		<p:column headerText="Tipo Mano" sortBy="#{mo.tipoMano}"  filterMatchMode="contains" filterBy="#{mo.tipoMano}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.tipoMano}" /></f:facet>
		         <f:facet name="input"><p:inputText id="tmano" value="#{mo.tipoMano}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
    
     
    		<p:column headerText="Total Horas" sortBy="#{mo.totalHora}"  filterMatchMode="contains" filterBy="#{mo.totalHora}">		                
		   <p:cellEditor>
		         <f:facet name="output"><h:outputText value="#{mo.totalHora}" /></f:facet>
		         <f:facet name="input"><p:inputText id="total" value="#{mo.totalHora}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
    
    		    
 		  
		     
	
    
</p:dataTable>   

<p:contextMenu for="datatablemanodeobra"> 
		<p:menuitem rendered="#{mb_Usuario.acceso('BORRAR','manodeobra')}" value=" Borrar" update="formmanodeobra message"  
		       actionListener="#{mb_ManoObra.delete(mb_ManoObra.moSelected)}" icon="ui-icon-trash" >
			<p:confirm   header="Borrar mano de obra" message="Seguro que quieres borrar?" icon="ui-icon-alert"  />
		</p:menuitem>		
	</p:contextMenu> 

</h:form>


<p:confirmDialog dynamic="true" header="Borrar mano de obra" global="true" showEffect="fade" hideEffect="fade" 
     widgetVar="confirmDialog" id="confirmDialog" >
   <p:commandButton value="Borrar" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"  > 
   </p:commandButton>
   <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
</p:confirmDialog>				
				
					
<script type="text/javascript">
function handleAddRequest(xhr, status, args) {

    if(args.validationFailed ) {
    	alert("fallo validacion");
        PF('addmanodeobra').jq.effect("shake", {times:5}, 100);
    }
    else {
    	
        PF('addmanodeobra').hide(); 
       // PF('datatablecliente').addRow();
    }
}   
</script>

<p:dialog id="addmanodeobra" header="Agregar mano de obra"  widgetVar="addmanodeobra" showEffect="explode" hideEffect="fade"  modal="true"   dynamic="true"   >
 
 
 	
 <h:form >

 	 <p:panelGrid id="panelAddMO"  border="2" cellpadding="5" cellspacing="1" columns="2">     
			<p:outputLabel title="Ingrese parte del nombre o id del funcionario" value="Funcionario :" for="fid" />  
			<p:autoComplete title="Ingrese parte del nombre o id del funcionario" id="fid" value="#{mb_ManoObra.funcionarioOBJ}"
				completeMethod="#{mb_Usuario.completarFuncionario}"
				var="theme" itemLabel="#{theme.nombre}" itemValue="#{theme}"
			 	converter="ConverterFuncionario" forceSelection="true" 
			  style="float:right !important;margin:0px 0px 3px 0px;" required="true"/> 
			 
			<p:outputLabel value="Cliente" for="cliente" />
			<p:autoComplete title="Ingrese parte del nombre o id del cliente"   id="cliente" value="#{mb_ManoObra.clienteOBJ}"
 				completeMethod="#{mb_Usuario.completarCliente}" 
				var="theme" itemLabel="#{theme.nombre}" itemValue="#{theme}"
 				converter="ConverterCliente" forceSelection="true" style="float:right !important;margin:0px 0px 3px 0px;"/> 
	
			
			<p:outputLabel  value="Fecha:" for="fechamo"/>
      <p:calendar id="fechamo" value="#{mb_ManoObra.fecha}" effect="fold" required="true" style="float:right !important;margin:0px 0px 3px 0px;"/>	

			<p:outputLabel value="MyR:" for="myr"  rendered="#{!verIDOT}" />   
			<p:inputText id="myr" label="myr" value="#{mb_ManoObra.myr}" rendered="#{!verIDOT}" 
			  style="float:right !important;margin:0px 0px 3px 0px;"/>	       	
			
			<p:outputLabel value="Id OT:" for="ordenTrabajo" rendered="#{verIDOT}" /> 
			<p:outputLabel id="ordenTrabajo" label="ordenTrabajo"  rendered="#{verIDOT}" value="#{mb_ManoObra.ordenTrabajo}" style="float:right !important;margin:0px 0px 3px 0px;"/>	
			
			
			<p:outputLabel value="Tipo de Hora:" for="tipoHora" /> 
			<p:selectOneMenu value="#{mb_ManoObra.tipoHora}" style="width:80%" id="tipoHora" required="true" >					
          <f:selectItem itemLabel="Comun" itemValue="COMUN" />
          <f:selectItem itemLabel="Extra. comun" itemValue="EXT-C" /> 
          <f:selectItem itemLabel="Extra. excepcional" itemValue="EXT-E" />                       
      </p:selectOneMenu>
  
 
			<p:outputLabel value="Tipo de Mano:" for="tipoMano" />   			  
			<p:selectOneMenu value="#{mb_ManoObra.tipoMano}" style="width:80%" id="tipoMano" required="true" >					
          <f:selectItem itemLabel="Trabajadas" itemValue="T" />
          <f:selectItem itemLabel="Perdidas" itemValue="P" />                       
      </p:selectOneMenu>
                

			<p:outputLabel value="Total de horas:" for="totalHora" /> 
			<p:inputNumber  id="totalHora" value="#{mb_ManoObra.totalHora}" required="true" decimalSeparator="," thousandSeparator="." />  
			
			<p:commandButton value="Agregar" actionListener="#{mb_ManoObra.add}"  oncomplete="handleAddRequest(xhr, status, args);"
			update="@([id$=datatablemanodeobra]) message" />	
 
		</p:panelGrid>
 
</h:form>
 </p:dialog>
 
 


 
</ui:define>


</ui:composition>



 
<!-- 		<p:column headerText="Funcionario ID:" sortBy="#{mo.funcionarioID}"  filterMatchMode="contains" filterBy="#{mo.funcionarioID}">		                 -->
<!-- 		   <p:cellEditor> -->
<!-- 		         <f:facet name="output"><h:outputText value="#{mo.funcionarioID}" /></f:facet> -->
<!-- 		         <f:facet name="input"><p:inputText id="funcionario" value="#{mo.funcionarioID}" style="width:100%"/></f:facet> -->
<!-- 			</p:cellEditor> -->
<!-- 		</p:column> -->
		

<!-- <f:event type="preRenderView" listener="#{mb_ManoObra.recargarLista}" /> -->
