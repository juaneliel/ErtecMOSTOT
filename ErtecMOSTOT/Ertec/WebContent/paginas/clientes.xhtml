<?xml version='1.0' encoding='UTF-8' ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/templates/layout.xhtml"
 xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
      
<ui:define name="cuerpo"> 
  	
  <h:form id="datatablecliente">
  
  
    <p:dataTable var="cliente" value="#{mb_Cliente.lista}" id="datatable2"
		 paginator="true" rows ="50" resizableColumns="true" liveResize="true" draggableColumns="true" 
		 scrollable="true" scrollHeight="500"  scrollWidth="100%"   
		 editable="true" 
		 style="text-align:left;font-size: 90% !important;color: red;font-weight: bold;"
		 paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {Exporters}"
                rowsPerPageTemplate="10,50,100"
		 >
		 
		 	<f:facet name="{Exporters}">
	    <h:commandLink>
	      <p:graphicImage name="/images/excel.png" width="24"/>
	      <p:dataExporter type="xls" target="datatable2" fileName="clientes"   />
	    </h:commandLink>
	
	    <h:commandLink>
	      <p:graphicImage name="/images/pdf.png" width="24"/>
	      <p:dataExporter type="pdf" target="datatable2" fileName="clientes"  />
	    </h:commandLink> 
		</f:facet>
		 
		 
		 
      	<f:facet name="header">
			Clientes	
			<p:commandButton id="toggler" type="button" value="Elegir Columnas" style="float:right" icon="ui-icon-calculator" />
			<p:columnToggler datasource="datatable2" trigger="toggler" />
      	</f:facet>
		 
		<p:ajax event="rowEdit" listener="#{mb_Cliente.onRowEdit}" update="message" />	 
		<p:ajax event="rowToggle" listener="#{mb_Cliente.recargarListaContratos(cliente.clienteID)}" update="expansioncliente" /> 
		 
		 

		 
		 
		<p:column style="width:16px" exportable="false">
 			<p:rowToggler />
		</p:column> 
		 
		<p:column headerText="Id" sortBy="#{cliente.clienteID}" style = "width:50px;text-align:center" filterStyle="width: 40px;" filterMatchMode="startsWith" filterBy="#{cliente.clienteID}">
			<h:outputText  value="#{cliente.clienteID}"/>
		</p:column>

		<p:column headerText="Nombre" sortBy="#{cliente.nombre}"  filterMatchMode="contains" filterBy="#{cliente.nombre}">		                
			<p:cellEditor>
	        	<f:facet name="output"><h:outputText value="#{cliente.nombre}" /></f:facet>
	       		<f:facet name="input"><p:inputText id="nombre" value="#{cliente.nombre}" style="width:100%"/></f:facet>
        	</p:cellEditor>
		</p:column> 
		 
		<p:column headerText="Direccion" sortBy="#{cliente.dirCliente}"  filterMatchMode="contains" filterBy="#{cliente.dirCliente}">		                
			<p:cellEditor>
				<f:facet name="output"><h:outputText value="#{cliente.dirCliente}" /></f:facet>
		 		<f:facet name="input"><p:inputText id="direccion" value="#{cliente.dirCliente}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
		     
		<p:column headerText="Localidad" sortBy="#{cliente.locCliente}"  filterMatchMode="contains" filterBy="#{cliente.locCliente}">		                
			<p:cellEditor>
	     		<f:facet name="output"><h:outputText value="#{cliente.locCliente}" /></f:facet>
	        	<f:facet name="input"><p:inputText id="locCliente" value="#{cliente.locCliente}" style="width:100%"/></f:facet>
       		</p:cellEditor>
		</p:column>
		  
		<p:column headerText="Telefono" sortBy="#{cliente.telCliente}"  filterMatchMode="contains" filterBy="#{cliente.telCliente}">		                
			<p:cellEditor>
				<f:facet name="output"><h:outputText value="#{cliente.telCliente}" /></f:facet>
				<f:facet name="input"><p:inputText id="telCliente" value="#{cliente.telCliente}" style="width:100%"/></f:facet>
			</p:cellEditor>
		</p:column>
		  
		  
		  	<p:column headerText="RUC" sortBy="#{cliente.rucCliente}"  filterMatchMode="contains" filterBy="#{cliente.rucCliente}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{cliente.rucCliente}" /></f:facet>
	               <f:facet name="input">               
	               		<p:inputMask   id="rucCliente" value="#{cliente.rucCliente}" >
								      	<p:keyFilter regEx="/[0-9_]/i" /> 
								  	</p:inputMask>	               
	               </f:facet>
           		</p:cellEditor>
		    </p:column>
		  
 

		  
		  
		  <p:column headerText="Credito" sortBy="#{cliente.credito}" style = "width:50px;text-align:center" filterStyle="width: 40px;" filterMatchMode="contains" filterBy="#{cliente.credito}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{cliente.credito}"  /></f:facet>
	               <f:facet name="input">
	                     <p:selectOneMenu value="#{cliente.credito}" style="width:80%" id="credito" required="true" >					
										       <f:selectItem itemLabel="SI" itemValue="SI" />
										       <f:selectItem itemLabel="NO" itemValue="NO" />                       
												</p:selectOneMenu>	               
	               </f:facet>
           		</p:cellEditor>
		    </p:column>
		  
		  
		   	<p:column headerText="Cta corriente" sortBy="#{cliente.cuentaCorriente}"  filterMatchMode="contains" filterBy="#{cliente.cuentaCorriente}">		                
		        <p:cellEditor>
	               <f:facet name="output"><h:outputText value="#{cliente.cuentaCorriente}" /></f:facet>
	               <f:facet name="input">
	               
	               <p:inputMask   id="ctacorriente" value="#{cliente.cuentaCorriente}"    >
								      	<p:keyFilter regEx="/[0-9_]/i" /> 
								  	</p:inputMask>
								 </f:facet>
           		</p:cellEditor>
		    </p:column>
		  
		  
		  
		   <p:column headerText="Editar"  style = "width:50px"  rendered="#{mb_Usuario.acceso('EDITAR',mb_Usuario.clientes)}" exportable="false">				
					<p:rowEditor  >
					</p:rowEditor>					
		    </p:column>
 
		    	   
		    	   
		    	   
		 <p:column toggleable="false" headerText="Bor"  style = "width:20px"  rendered="#{mb_Usuario.acceso('BORRAR',mb_Usuario.clientes)}" exportable="false">	
			<p:commandLink actionListener="#{mb_Cliente.delete(cliente)}" 
   	
   	update="datatablecliente message" >
        <p:confirm header="Confirmacion" message="Borrar cliente: #{cliente.nombre}?" icon="ui-icon-alert" />
  <span class="ui-icon ui-icon-trash"></span>
   	</p:commandLink>    
    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="Borrar" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" oncomplete="processWidget.clearFilters();" />
        <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
    </p:confirmDialog>
			</p:column>
		    	   
		    	   
		    	   
		    	   
		    	   
		    	   
		    	   
		    	   
		    	   
	   <p:rowExpansion id="expansioncliente">
   		  
		    
<p:commandButton value="Ver Contratos"  update=":formcontratos"
onclick="PF('vercontratos').show();"
action="#{mb_Cliente.recargarListaContratos(cliente.clienteID)}"/> 

		    
<p:commandButton value="Agregar Contrato" update=":formcontratos :formaddcontrato"
onclick="PF('addcontrato').show();" 
action="#{mb_Cliente.setClienteIDYNombre(cliente.clienteID,cliente.nombre)}"/>  
	    
 	
   </p:rowExpansion>
	
	</p:dataTable>

 </h:form> 
					
	<p:dialog header="Ver Contratos" widgetVar="vercontratos" appendTo="@(body)"  modal="true" width="90%" height="600"  dynamic="true">
	<ui:include src="/templates/templatecontratos.xhtml" id="vercontratos">	 				
	</ui:include>	
	</p:dialog>				
				
				
	<p:dialog header="Agregar Contratos" widgetVar="addcontrato" appendTo="@(body)" modal="true" width="430" height="520" dynamic="true">
	<ui:include src="/templates/templateaddcontrato.xhtml" id="addcontrato">			
	</ui:include>			
	</p:dialog>		



</ui:define>
</ui:composition>






